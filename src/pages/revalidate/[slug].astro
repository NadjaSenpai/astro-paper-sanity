---
export const prerender = false; // ← SSRで動作させるために false！

// GET or POST 両方対応したいなら request.method チェックもOK
export async function get({ params, url }) {
  const slug = params.slug;
  const secret = url.searchParams.get("secret");
  const expectedSecret = import.meta.env.REVALIDATE_SECRET;

  // ✅ optional: セキュリティチェック（任意）
  if (expectedSecret && secret !== expectedSecret) {
    return new Response("❌ Invalid secret", { status: 401 });
  }

  try {
    const result = await Astro.revalidate(`/posts/${slug}`);
    return new Response(`✅ Revalidated: /posts/${slug} (${result.status})`);
  } catch (e: any) {
    return new Response(`❌ Revalidation failed: ${e.message}`, { status: 500 });
  }
}
---
